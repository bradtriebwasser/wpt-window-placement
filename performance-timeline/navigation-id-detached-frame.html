<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <title>The navigation_id Detached Iframe Parent Page.</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
</head>

<body>
  <script>
    promise_test(t => {
      return new Promise(resolve => {
        const frame = document.createElement("iframe");
        frame.addEventListener("load", async () => {
          // Wait for iframe to be detached.
          console.log('parent: load listener entered');
          while (frame.contentWindow) {
            await new Promise(r => setTimeout(r, 10));
          }
          console.log('parent: load listener entered, iframe container removed');
          resolve();
        });
        frame.src = "resources/navigation-id-detached-frame-page.html";
        document.body.appendChild(frame);
        // const mm = performance.mark('parent-page');
        // console.log('parent-page mark name: ' + mm.name + ' nav_id: ' + mm.navigationId);
      });
    }, "Test that an event click that detaches the iframe on which it was fired" +
    " doesn't crash");
  </script>
</body>

</html>